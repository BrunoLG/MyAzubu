function Channel(a){this.channel=a}function userExists(a){var b;return $.ajax({method:"GET",url:"http://api.azubu.tv/public/channel/"+a,type:"json",async:!1,error:function(){b=!1},success:function(a){b={username:a.data.user.username}}}),b}function error(a){var b=document.getElementById("error");b.style.display="none",b.innerHTML="",b.style.display="block",b.innerHTML=a}function hideErrors(){var a=document.getElementById("error");a.style.display="none",a.innerHTML=""}String.prototype.isEmpty=function(){return 0===this.length||!this.trim()},Channel.prototype.getOnlineData=function(){var a;return $.ajax({method:"GET",url:"http://api.azubu.tv/public/channel/"+this.channel,type:"json",async:!1,error:function(){a=!1},success:function(b){a={username:b.data.user.username}}}),a},Channel.prototype.isOnline=function(){var a=!1;return $.ajax({method:"GET",url:"http://api.azubu.tv/public/channel/"+this.channel+"/info",type:"json",async:!1,success:function(b){b.data.is_live&&(a=!0)}}),a},Channel.prototype.getName=function(){return this.channel},window.onload=function(){localStorage.getItem("azubu_extension")||localStorage.setItem("azubu_extension",'{"usernames": [], "online": []}'),$("#azubu-logo").on("click",function(){chrome.tabs.create({url:"http://www.azubu.tv/",active:!0})}),$("#my-tt").on("click",function(){chrome.tabs.create({url:"http://twitter.com/gabrieljmj",active:!0})}),$(".tab-link").on("click",function(){var a=$(this).attr("data-tab");$(".channels").each(function(a){$(this).hide()}),$(".tab-link").each(function(a){$(this).removeClass("focus")}),$("#"+a).show(),$(this).addClass("focus")});var a=JSON.parse(localStorage.getItem("azubu_extension")),b=new Online(a.online),c=new Following(a.usernames),d=[],e=[],f=document.getElementById("add");for(var g in b.getAll())d.push('<a href="http://azubu.tv/'+b.getAll()[g]+'" class="channel" id="on-channel-link-'+b.getAll()[g]+'" style="width: 100%">'+b.getAll()[g]+"</a>");for(var g in c.getAll())e.push('<div><a href="http://azubu.tv/'+c.getAll()[g]+'" class="channel" id="channel-link-'+c.getAll()[g]+'">'+c.getAll()[g]+'</a><a href="#" data-channel="'+c.getAll()[g]+'" id="close-btn-'+c.getAll()[g]+'" class="remove-channel">X</a></div>');b.getAll().length&&(document.getElementById("online").innerHTML=d.join("")),c.getAll().length&&(document.getElementById("following").innerHTML=e.join("")),f.addEventListener("click",function(){hideErrors();var a=document.getElementById("username"),d=a.value;if(c.has(d)||d.isEmpty())a.value="";else{var e=new Channel(d),f=e.getOnlineData();document.getElementById("following");if(f){c.add(f.username);var g='<div><a href="http://azubu.tv/'+f.username+'" class="channel" id="channel-link-'+f.username+'">'+f.username+'</a><a href="#" data-channel="'+f.username+'" id="close-btn-'+f.username+'" class="remove-channel">X</a></div>';if(c.getAll().length-1?$("#following").append(g):$("#following").html(g),document.getElementById("channel-link-"+f.username).addEventListener("click",function(){chrome.tabs.create({url:"http://azubu.tv/"+f.username,active:!0})}),e.isOnline()){var h='<a href="http://azubu.tv/'+f.username+'" class="channel" id="on-channel-link-'+f.username+'" style="width: 100%">'+f.username+"</a>";b.getAll().length?$("#online").append(h):$("#online").html(h),b.add(f.username),document.getElementById("on-channel-link-"+f.username).addEventListener("click",function(){chrome.tabs.create({url:"http://azubu.tv/"+f.username,active:!0})})}document.getElementById("close-btn-"+f.username).addEventListener("click",function(){c.remove(f.username),$("#channel-link-"+f.username).remove(),$("#on-channel-link-"+f.username).remove(),$("#close-btn-"+f.username).remove(),b.has(f.username)&&b.remove(f.username)}),a.value=""}else error("User not found: "+d)}}),$(".channel").on("click",function(){chrome.tabs.create({url:$(this).attr("href"),active:!0})}),$(".remove-channel").on("click",function(){var a=$(this).attr("data-channel");c.has(a)&&(c.remove(a),$("#channel-link-"+a).remove(),$("#on-channel-link-"+a).remove(),$("#close-btn-"+a).remove(),b.has(a)&&b.remove(a))}),$("#refresh").on("click",function(){if(!localStorage.getItem("azubu_extension_running")){var c=(JSON.parse(localStorage.getItem("azubu_extension")),new Online(a.online),new Following(a.usernames));for(var d in c.getAll()){var e=new Channel(c.getAll()[d]);if(e.isOnline()){if(!b.has(e.getName())){var f='<a href="http://azubu.tv/'+e.getName()+'" class="channel" id="on-channel-link-'+e.getName()+'" style="width: 100%">'+e.getName()+"</a>";b.getAll().length?$("#online").append(f):$("#online").html(f),b.add(e.getName())}}else b.has(e.getName())&&($("#on-channel-link-"+e.getName()).remove(),b.remove(e.getName()))}}})};