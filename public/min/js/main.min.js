function Channel(a){this.channel=a}function userExists(a){var b;return $.ajax({method:"GET",url:"http://api.azubu.tv/public/channel/"+a,type:"json",async:!1,error:function(){b=!1},success:function(a){b={username:a.data.user.username}}}),b}function msg(a){var b=document.getElementById("msg");b.style.display="none",b.innerHTML="",b.style.display="block",b.innerHTML=a}function hideMsgs(){var a=document.getElementById("msg");a.style.display="none",a.innerHTML=""}function getStreamData(a){var b=JSON.parse(localStorage.getItem("azubu_channels_info"));return b[a]}String.prototype.isEmpty=function(){return 0===this.length||!this.trim()},Channel.prototype.getOnlineData=function(){var a;return $.ajax({method:"GET",url:"http://api.azubu.tv/public/channel/"+this.channel,type:"json",async:!1,error:function(){a=!1},success:function(b){a={username:b.data.user.username}}}),a},Channel.prototype.isOnline=function(){var a=!1;return $.ajax({method:"GET",url:"http://api.azubu.tv/public/channel/"+this.channel+"/info",type:"json",async:!1,success:function(b){b.data.is_live&&(a=!0)}}),a},Channel.prototype.getName=function(){return this.channel},window.onload=function(){function a(a){var b=getStreamData(a);return'<a href="'+d+"/"+a+'" class="channel" id="on-channel-link-'+a+'" style="width: 100%"><div class="live-channel"><b>'+a+'</b></div><div class="live-playing">playing <b>'+b.category.title+"</b> - <small>"+b.view_count+" viwers</small></div></a>"}localStorage.getItem("azubu_extension")||localStorage.setItem("azubu_extension",'{"usernames": [], "online": []}');var b=JSON.parse(localStorage.getItem("azubu_extension_configs")),c=b.oldschool.on?"oldschool.":"",d="http://"+c+"azubu.com";$("#azubu-logo").on("click",function(){chrome.tabs.create({url:"http://www.azubu.tv/",active:!0})}),$("#my-tt").on("click",function(){chrome.tabs.create({url:"http://twitter.com/gabrieljmj",active:!0})}),$(".tab-link").on("click",function(){var a=$(this).attr("data-tab");$(".channels").each(function(a){$(this).hide()}),$(".tab-link").each(function(a){$(this).removeClass("focus")}),$("#"+a).show(),$(this).addClass("focus")});var e=JSON.parse(localStorage.getItem("azubu_extension")),f=new Online(e.online),g=new Following(e.usernames),h=[],i=[],j=document.getElementById("add");for(var k in f.getAll())h.push(a(f.getAll()[k]));for(var k in g.getAll())i.push('<div><a href="'+d+"/"+g.getAll()[k]+'" class="channel" id="channel-link-'+g.getAll()[k]+'">'+g.getAll()[k]+'</a><a href="#" data-channel="'+g.getAll()[k]+'" id="close-btn-'+g.getAll()[k]+'" class="remove-channel">X</a></div>');f.getAll().length&&(document.getElementById("online").innerHTML=h.join("")),g.getAll().length&&(document.getElementById("following").innerHTML=i.join("")),j.addEventListener("click",function(){hideMsgs();var b=document.getElementById("username"),c=b.value;if(g.has(c)||c.isEmpty())b.value="";else{var e=new Channel(c),h=e.getOnlineData();document.getElementById("following");if(h){g.add(h.username);var i='<div><a href="'+d+"/"+h.username+'" class="channel" id="channel-link-'+h.username+'">'+h.username+'</a><a href="#" data-channel="'+h.username+'" id="close-btn-'+h.username+'" class="remove-channel">X</a></div>';if(g.getAll().length-1?$("#following").append(i):$("#following").html(i),document.getElementById("channel-link-"+h.username).addEventListener("click",function(){chrome.tabs.create({url:d+"/"+h.username,active:!0})}),e.isOnline()){var j=a(e.getName());f.getAll().length?$("#online").append(j):$("#online").html(j),f.add(h.username),document.getElementById("on-channel-link-"+h.username).addEventListener("click",function(){chrome.tabs.create({url:d+"/"+h.username,active:!0})})}document.getElementById("close-btn-"+h.username).addEventListener("click",function(){hideMsgs(),g.remove(h.username),$("#channel-link-"+h.username).remove(),$("#on-channel-link-"+h.username).remove(),$("#close-btn-"+h.username).remove(),f.has(h.username)&&f.remove(h.username),f.getAll().length||$("#online").html('<div class="empty-msg">There\'s no online channels that you are following.</div>'),msg("<b>"+h.username+"</b> unfollowed successfully!"),setTimeout(function(){hideMsgs()},3e3)}),b.value="",msg("<b>"+h.username+"</b> followed successfully!"),setTimeout(function(){hideMsgs()},3e3)}else msg("User not found: "+c)}}),$(".channel").on("click",function(){chrome.tabs.create({url:$(this).attr("href"),active:!0})}),$(".remove-channel").on("click",function(){hideMsgs();var a=$(this).attr("data-channel");g.has(a)&&(g.remove(a),$("#channel-link-"+a).remove(),$("#on-channel-link-"+a).remove(),$("#close-btn-"+a).remove(),f.has(a)&&f.remove(a),f.getAll().length||$("#online").html('<div class="empty-msg">There\'s no online channels that you are following.</div>'),msg("<b>"+a+"</b> unfollowed successfully!"),setTimeout(function(){hideMsgs()},3e3))}),$("#refresh").on("click",function(){if(!localStorage.getItem("azubu_extension_running")){var b=(JSON.parse(localStorage.getItem("azubu_extension")),new Online(e.online),new Following(e.usernames));for(var c in b.getAll()){var d=new Channel(b.getAll()[c]);if(d.isOnline()){if(!f.has(d.getName())){var g=a(d.getName());f.getAll().length?$("#online").append(g):$("#online").html(g),f.add(d.getName())}}else f.has(d.getName())&&($("#on-channel-link-"+d.getName()).remove(),f.remove(d.getName()))}}})};