function Channel(a){this.channel=a}function userExists(a){var b;return $.ajax({method:"GET",url:"http://api.azubu.tv/public/channel/"+a,type:"json",async:!1,error:function(){b=!1},success:function(a){b={username:a.data.user.username}}}),b}function msg(a){var b=document.getElementById("msg");b.style.display="none",b.innerHTML="",b.style.display="block",b.innerHTML=a}function hideMsgs(){var a=document.getElementById("msg");a.style.display="none",a.innerHTML=""}String.prototype.isEmpty=function(){return 0===this.length||!this.trim()},Channel.prototype.getOnlineData=function(){var a;return $.ajax({method:"GET",url:"http://api.azubu.tv/public/channel/"+this.channel,type:"json",async:!1,error:function(){a=!1},success:function(b){a={username:b.data.user.username}}}),a},Channel.prototype.isOnline=function(){var a=!1;return $.ajax({method:"GET",url:"http://api.azubu.tv/public/channel/"+this.channel+"/info",type:"json",async:!1,success:function(b){b.data.is_live&&(a=!0)}}),a},Channel.prototype.getName=function(){return this.channel},window.onload=function(){localStorage.getItem("azubu_extension")||localStorage.setItem("azubu_extension",'{"usernames": [], "online": []}');var a=JSON.parse(localStorage.getItem("azubu_extension_configs")),b=a.oldschool.on?"oldschool.":"",c="http://"+b+"azubu.com";$("#azubu-logo").on("click",function(){chrome.tabs.create({url:"http://www.azubu.tv/",active:!0})}),$("#my-tt").on("click",function(){chrome.tabs.create({url:"http://twitter.com/gabrieljmj",active:!0})}),$(".tab-link").on("click",function(){var a=$(this).attr("data-tab");$(".channels").each(function(a){$(this).hide()}),$(".tab-link").each(function(a){$(this).removeClass("focus")}),$("#"+a).show(),$(this).addClass("focus")});var d=JSON.parse(localStorage.getItem("azubu_extension")),e=new Online(d.online),f=new Following(d.usernames),g=[],h=[],i=document.getElementById("add");for(var j in e.getAll())g.push('<a href="'+c+"/"+e.getAll()[j]+'" class="channel" id="on-channel-link-'+e.getAll()[j]+'" style="width: 100%">'+e.getAll()[j]+"</a>");for(var j in f.getAll())h.push('<div><a href="'+c+"/"+f.getAll()[j]+'" class="channel" id="channel-link-'+f.getAll()[j]+'">'+f.getAll()[j]+'</a><a href="#" data-channel="'+f.getAll()[j]+'" id="close-btn-'+f.getAll()[j]+'" class="remove-channel">X</a></div>');e.getAll().length&&(document.getElementById("online").innerHTML=g.join("")),f.getAll().length&&(document.getElementById("following").innerHTML=h.join("")),i.addEventListener("click",function(){hideMsgs();var a=document.getElementById("username"),b=a.value;if(f.has(b)||b.isEmpty())a.value="";else{var d=new Channel(b),g=d.getOnlineData();document.getElementById("following");if(g){f.add(g.username);var h='<div><a href="'+c+"/"+g.username+'" class="channel" id="channel-link-'+g.username+'">'+g.username+'</a><a href="#" data-channel="'+g.username+'" id="close-btn-'+g.username+'" class="remove-channel">X</a></div>';if(f.getAll().length-1?$("#following").append(h):$("#following").html(h),document.getElementById("channel-link-"+g.username).addEventListener("click",function(){chrome.tabs.create({url:c+"/"+g.username,active:!0})}),d.isOnline()){var i='<a href="'+c+"/"+g.username+'" class="channel" id="on-channel-link-'+g.username+'" style="width: 100%">'+g.username+"</a>";e.getAll().length?$("#online").append(i):$("#online").html(i),e.add(g.username),document.getElementById("on-channel-link-"+g.username).addEventListener("click",function(){chrome.tabs.create({url:c+"/"+g.username,active:!0})})}document.getElementById("close-btn-"+g.username).addEventListener("click",function(){hideMsgs(),f.remove(g.username),$("#channel-link-"+g.username).remove(),$("#on-channel-link-"+g.username).remove(),$("#close-btn-"+g.username).remove(),e.has(g.username)&&e.remove(g.username),e.getAll().length||$("#online").html('<div class="empty-msg">There\'s no online channels that you are following.</div>'),msg("<b>"+g.username+"</b> unfollowed successfully!"),setTimeout(function(){hideMsgs()},3e3)}),a.value="",msg("<b>"+g.username+"</b> followed successfully!"),setTimeout(function(){hideMsgs()},3e3)}else msg("User not found: "+b)}}),$(".channel").on("click",function(){chrome.tabs.create({url:$(this).attr("href"),active:!0})}),$(".remove-channel").on("click",function(){hideMsgs();var a=$(this).attr("data-channel");f.has(a)&&(f.remove(a),$("#channel-link-"+a).remove(),$("#on-channel-link-"+a).remove(),$("#close-btn-"+a).remove(),e.has(a)&&e.remove(a),e.getAll().length||$("#online").html('<div class="empty-msg">There\'s no online channels that you are following.</div>'),msg("<b>"+a+"</b> unfollowed successfully!"),setTimeout(function(){hideMsgs()},3e3))}),$("#refresh").on("click",function(){if(!localStorage.getItem("azubu_extension_running")){var a=(JSON.parse(localStorage.getItem("azubu_extension")),new Online(d.online),new Following(d.usernames));for(var b in a.getAll()){var f=new Channel(a.getAll()[b]);if(f.isOnline()){if(!e.has(f.getName())){var g='<a href="'+c+"/"+f.getName()+'" class="channel" id="on-channel-link-'+f.getName()+'" style="width: 100%">'+f.getName()+"</a>";e.getAll().length?$("#online").append(g):$("#online").html(g),e.add(f.getName())}}else e.has(f.getName())&&($("#on-channel-link-"+f.getName()).remove(),e.remove(f.getName()))}}})};