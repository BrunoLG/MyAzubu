function checkOnline(a){localStorage.setItem("azubu_extension_running",!0);var b=JSON.parse(localStorage.getItem("azubu_extension")),c=new Following(b.usernames),d=new Online(b.online),e=JSON.parse(localStorage.getItem("azubu_extension_configs")),f={};localStorage.removeItem("azubu_channels_info");for(var g in c.getAll())if(c.hasOwnProperty()){var h=c.getAll()[g];f[h]={}}localStorage.setItem("azubu_channels_info",JSON.stringify(f));for(var g in c.getAll()){var h=c.getAll()[g];$.ajax({method:"GET",url:"http://api.azubu.tv/public/channel/"+h+"/info",type:"json",async:!1,success:function(b){if(setChannelInfo(b.data),b.data.is_live){if(!d.has(h)&&(d.add(h),e.notifications.on)){var c={body:"started streamming "+b.data.category.title,icon:b.data.url_thumbnail};e.notifications.sound&&(c.silent=!1,a||playNotificationSound());var f=new Notification(h,c),g="http://azubu.tv/"+h;f.onclick=function(){window.open(g)},setTimeout(function(){f.close()},6e3)}}else d.has(h)&&d.remove(h)}})}a&&d.getAll().length&&e.notifications.sound&&playNotificationSound(),chrome.browserAction.setBadgeText({text:""+d.getAll().length}),localStorage.removeItem("azubu_extension_running")}function setChannelInfo(a,b){var c=JSON.parse(localStorage.getItem("azubu_channels_info"));c[a]=b,localStorage.setItem("azubu_channels_info",JSON.stringify(c))}function playNotificationSound(){var a=new Audio("public/sounds/notification.mp3");a.play()}chrome.browserAction.setBadgeText({text:"0"}),localStorage.getItem("azubu_extension")||localStorage.setItem("azubu_extension",JSON.stringify({usernames:[],online:[]})),localStorage.getItem("azubu_extension_configs")||localStorage.setItem("azubu_extension_configs",JSON.stringify({notifications:{on:!0,sound:!1},refresh:{interval:3e4},oldschool:{on:!1}})),setInterval(function(){var a=JSON.parse(localStorage.getItem("azubu_extension")),b=new Following(a.usernames),c=new Online(a.online);for(var d in c.getAll())b.has(c.getAll()[d])||c.remove(c.getAll()[d]);chrome.browserAction.setBadgeText({text:""+c.getAll().length})},500);var extData=JSON.parse(localStorage.getItem("azubu_extension"));extData.online=[],localStorage.setItem("azubu_extension",JSON.stringify(extData));var configs=JSON.parse(localStorage.getItem("azubu_extension_configs"));localStorage.setItem("azubu_extension_running",!0),checkOnline(!0),localStorage.removeItem("azubu_extension_running"),setInterval(function(){checkOnline(!1)},configs.refresh.interval);